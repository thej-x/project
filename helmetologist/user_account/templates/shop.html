
{% extends "base.html" %}

{% block title %} User login{% endblock %}
{% load static %}

{% block extra_styles %}
<style>



    .widget-content {
        padding: 10px; /* Adjust as needed */
    }
    .category-item {
        display: flex; /* Use flexbox to align items in a row */
        align-items: center; /* Align items vertically centered */
        margin-bottom: 10px; /* Space between each item */
    }
    
    .category-checkbox {
        margin-right: 8px; /* Space between checkbox and label */
    }
    
    .category-label {
        font-size: 14px; /* Adjust font size as needed */
    }
</style>

{% endblock %}

{% block nav_links %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.2/nouislider.min.css">


{% endblock %}
   


{% block content %}    




            <!--Body Container-->
            <div id="page-content">  
                <!--Collection Banner-->
                <div class="collection-header">
                    <div class="collection-hero">
                        <div class="collection-hero__image"></div>
                        <div class="collection-hero__title-wrapper container">
                            <h2 class="collection-hero__title">Shop page</h2>
                            <div class="breadcrumbs text-uppercase mt-1 mt-lg-2"><a href="{% url 'index' %}" title="Back to the home page">Home</a><span>|</span><span class="fw-bold">Shop Page</span></div>
                        </div>
                    </div>
                </div>
                <!--End Collection Banner-->

                <div class="container">
                    <div class="row">
                        <!--Sidebar-->
                        <div class="col-12 col-sm-12 col-md-12 col-lg-3 sidebar filterbar">
                            <div class="closeFilter d-block d-lg-none"><i class="icon icon an an-times-r"></i></div>
                            <div class="sidebar_tags">

                               
                                <!--Categories-->
                                <div class="sidebar_widget categories filterBox filter-widget">
                                    <div class="widget-title"><h2 class="mb-0">Categories</h2></div>
                                    <div class="widget-content filterDD">
                                        {% for category in categories %}
                                            <div class="category-item">
                                                <input type="checkbox" id="category-item-{{ forloop.counter }}" name="{{category.id}}" value="{{ category.id }}" class="category-checkbox checker">
                                                <label for="category-item-{{ forloop.counter }}" class="site-nav category-label">
                                                    {{ category.cat_name }} <span>({{ category.products_set.all.count }})</span>
                                                </label>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div> 
                                <!--Categories-->
                                <!-- Price Filter -->
                                <div class="sidebar_widget filterBox filter-widget">
                                    <div class="widget-title"><h2 class="mb-0">Price</h2></div>
                                    <form action="#" method="post" class="price-filter filterDD">
                                         {% csrf_token %}  
                                        <div id="slider-range" class="mt-2"></div>
                                        <div class="row">
                                            <div class="col-6">
                                                <p class="no-margin"><input id="amount" type="text" readonly></p>
                                            </div>
                                            <div class="col-6 text-right margin-25px-top">
                                                <button class="btn btn--small rounded">Filter</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <!-- End Price Filter -->
                                
                              
                                
                                
                                <!--Availability-->
                                <div class="sidebar_widget filterBox filter-widget size-swacthes availability">
                                    <div class="widget-title"><h2 class="mb-0">Availability</h2></div>
                                    <div class="filterDD">
                                        <ul class="clearfix">
                                            <li><input type="checkbox" value="instock" id="instock"><label for="instock"><span></span>In stock</label></li>
                                            <li><input type="checkbox" value="outofstock" id="outofstock"><label for="outofstock"><span></span>Out of stock</label></li>
                                        </ul>
                                    </div>
                                </div>
                                <!--End Availability-->
                                
                                <!--Popular Products-->
                                <div class="sidebar_widget sidePro">
                                    <div class="widget-title"><h2>Popular Products</h2></div>
                                    <div class="widget-content">
                                        <div class="sideProSlider grid-products">
                                            <div class="col-12 item">
                                                <!--Start Product Image-->
                                                <div class="product-image">
                                                    <!--Start Product Image-->
                                                    <a href="product-layout1.html" class="product-img">
                                                        <!-- image -->
                                                        <img class="primary blur-up lazyload" data-src="assets/images/products/product-1.jpg" src="assets/images/products/product-1.jpg" alt="image" title="">
                                                        <!-- End image -->
                                                        <!-- Hover image -->
                                                        <img class="hover blur-up lazyload" data-src="assets/images/products/product-1-1.jpg" src="assets/images/products/product-1-1.jpg" alt="image" title="">
                                                        <!-- End hover image -->
                                                    </a>
                                                    <!--End Product Image-->

                                                    <!--Countdown Timer-->
                                                    <div class="saleTime" data-countdown="2029/03/01"></div>
                                                    <!--End Countdown Timer-->

                                                    <!--Product Button-->
                                                    <div class="button-set style0 d-none d-md-block">
                                                        <ul>
                                                            <!--Cart Button-->
                                                            <li><a class="btn-icon btn cartIcon pro-addtocart-popup" href="#pro-addtocart-popup"><i class="icon an an-cart-l"></i> <span class="tooltip-label top">Add to Cart</span></a></li>
                                                            <!--End Cart Button-->
                                                            
                                                            <!--Wishlist Button-->
                                                            <li><a class="btn-icon wishlist add-to-wishlist" href="my-wishlist.html"><i class="icon an an-heart-l"></i> <span class="tooltip-label top">Add To Wishlist</span></a></li>
                                                            <!--End Wishlist Button-->
                                                           
                                                        </ul>
                                                    </div>
                                                    <!--End Product Button-->  
                                                </div>
                                                <!--End Product Image-->
                                                <!--Start Product Details-->
                                                <div class="product-details text-center">
                                                    <!--Product Name-->
                                                    <div class="product-name text-uppercase">
                                                        <a href="product-layout1.html">Floral Crop Top</a>
                                                    </div>
                                                    <!--End Product Name-->
                                                    <!--Product Price-->
                                                    <div class="product-price">
                                                        <span class="old-price">$199.00</span>
                                                        <span class="price">$219.00</span>
                                                    </div>
                                                    <!--End Product Price-->
                                                    <!--Product Review-->
                                                    <div class="product-review d-flex align-items-center justify-content-center">
                                                        <i class="an an-star"></i><i class="an an-star"></i><i class="an an-star"></i><i class="an an-star"></i><i class="an an-star-o"></i>
                                                        <span class="caption hidden ms-2">3 reviews</span>
                                                    </div>
                                                    <!--End Product Review-->
                                                    <!--Color Variant -->
                                                    <ul class="image-swatches swatches mb-0">
                                                        <li class="radius blue medium"><span class="swacth-btn"></span><span class="tooltip-label">Blue</span></li>
                                                        <li class="radius pink medium"><span class="swacth-btn"></span><span class="tooltip-label">Pink</span></li>
                                                        <li class="radius red medium"><span class="swacth-btn"></span><span class="tooltip-label">Red</span></li>
                                                        <li class="radius yellow medium"><span class="swacth-btn"></span><span class="tooltip-label">Yellow</span></li>
                                                    </ul>
                                                    <!--End Color Variant-->
                                                </div>
                                                <!--End Product Details-->
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <!--End Popular Products-->
                                <!--Banner-->
                                <div class="sidebar_widget static-banner">
                                    <a href="shop-fullwidth.html"><img src="{% static 'assets/images/shop-banner.PNG' %}" alt="image"></a>
                                </div>
                                <!--End Banner-->
                            </div>
                        </div>
                        <!--End Sidebar-->

                        <!--Main Content-->
                        <div class="col-12 col-sm-12 col-md-12 col-lg-9 main-col">
                            <div class="page-title"><h1>Helmets</h1></div>
                            <!--Active Filters-->
                            <!-- <ul class="active-filters d-flex flex-wrap align-items-center m-0 list-unstyled">
                                <li><a href="#">Clear all</a></li>
                                <li><a href="#">Men <i class="an an-times-l"></i></a></li>
                                <li><a href="#">Accessories <i class="an an-times-l"></i></a></li>
                            </ul> -->
                            <!--End Active Filters-->
                            <!--Toolbar-->
                            <div class="toolbar">
                                <div class="filters-toolbar-wrapper">
                                    <ul class="list-unstyled d-flex align-items-center">
                                        <li class="product-count d-flex align-items-center">
                                            <button type="button" class="btn btn-filter an an-slider-3 d-inline-flex d-lg-none me-2 me-sm-3"><span class="hidden">Filter</span></button>
                                            <div class="filters-toolbar__item">
                                                
                                                <span class="filters-toolbar__product-count d-none d-sm-block">Showing products</span>
                                                
                                            </div>
                                        </li>
                                        <li class="collection-view ms-sm-auto">
                                            <div class="filters-toolbar__item collection-view-as d-flex align-items-center me-3">
                                                <a href="javascript:void(0)" class="change-view prd-grid change-view--active"><i class="icon an an-th" aria-hidden="true"></i><span class="tooltip-label">Grid View</span></a>
                                                <a href="javascript:void(0)" class="change-view prd-list"><i class="icon an an-th-list" aria-hidden="true"></i><span class="tooltip-label">List View</span></a>
                                            </div>
                                        </li>
                                        <li class="filters-sort ms-auto ms-sm-0">
                                            <div class="filters-toolbar__item">
                                                <label for="SortBy" class="hidden">Sort by:</label>
                                                <select name="SortBy" id="SortBy" class="filters-toolbar__input filters-toolbar__input--sort">
                                                    <option value="featured" selected="selected">Featured</option>
                                                    
                                                    <option value="title-ascending">Alphabetically, A-Z</option>
                                                    <option value="title-descending">Alphabetically, Z-A</option>
                                                    <option value="price-ascending">Price, low to high</option>
                                                    <option value="price-descending">Price, high to low</option>
                                                    <option value="created-ascending">Date, old to new</option>
                                                    <option value="created-descending">Date, new to old</option>
                                                </select>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <!--End Toolbar-->

                            <!--Product Grid-->
                            <div class="grid-products grid--view-items prd-grid">
                                <div class="row" id = "product-container">




                                    {% for product in products %}
                                    {% if product.is_listed %}
                                    <div class="col-6 col-sm-6 col-md-4 col-lg-4 item">
                                        <!--Start Product Image-->
                                        <div class="product-image">
                                            <!--Start Product Image-->
                                            {% with product.images.first as primary_image %}
                                            <a href="{% url 'product' product_slug=product.slug product_id=product.id %}" class="product-img">
                                                <!-- image -->
                                                <img class="primary blur-up lazyload" data-src="{{ primary_image.image.url }}" src="{{ primary_image.image.url }}" alt="image" title="">
                                                <!-- End image -->
                                                {% endwith %}
                                                {% with product.images.last as hover_image %}
                                                <!-- Hover image -->
                                                <img class="hover blur-up lazyload" data-src="{{hover_image.image.url}}" src="{{hover_image.image.url}}" alt="image" title="">
                                                <!-- End hover image -->
                                                {% endwith %}
                                                <!-- product label -->
                                                <!-- <div class="product-labels"><span class="lbl on-sale rounded">Sale</span></div> -->
                                                <!-- End product label -->
                                            </a>
                                            <!--End Product Image-->

                                            <!--Product Button-->
                                            <div class="button-set style2">
                                                <ul>
                                                    <li>
                                                        <!--Cart Button-->

                                                        <!-- Custom Add to Cart Button -->

                                                        <button data-product="{{ product.id }}" method="post" data-action="add" class="btn-icon btn btn-addto-cart pro-addtocart-popup update-cart">
                                                            <i class="icon an an-cart-l"></i>
                                                            <span class="tooltip-label">Add to Cart</span>
                                                        </button>
                                                      

                                                        <!--end Cart Button-->
                                                    </li>
                                                   <li>
                                                        <!--Wishlist Button-->
                                                        <a class="btn-icon wishlist add-to-wishlist" href="my-wishlist.html">
                                                            <i class="icon an an-heart-l"></i>
                                                            <span class="tooltip-label">Add To Wishlist</span>
                                                        </a>
                                                        <!--End Wishlist Button-->
                                                    </li>
                                                </ul>
                                            </div>
                                            <!--End Product Button--> 
                                        </div>
                                        <!--End Product Image-->
                                        <!--Start Product Details-->
                                        <div class="product-details text-center">
                                            <!--Product Name-->
                                            <div class="product-name text-uppercase">
                                                <a href="product-layout1.html">{{product.name|truncatechars:50}}</a>
                                            </div>
                                            <!--End Product Name-->
                                            <!--Product Price-->
                                            <div class="product-price">
                                                <span class="price">{{product.price}}</span>
                                            </div>
                                            <!--End Product Price-->
                                            <!--Product Review-->
                                            <div class="product-review d-flex align-items-center justify-content-center">
                                                <i class="an an-star"></i><i class="an an-star"></i><i class="an an-star"></i><i class="an an-star"></i><i class="an an-star"></i>
                                                <span class="caption hidden ms-2">8 reviews</span>
                                            </div>
                                            <!--End Product Review-->
                                           
                                            
                                        </div>
                                        <!--End Product Details-->
                                    </div>


                                    {% endif %}
                                    {% endfor %}
                                    




                                   
                                    










                                </div>
                            </div>
                            <!--End Product Grid-->

                            <!--Pagination Classic-->
                            <hr class="clear">
                            <div class="pagination">
                                <ul>
                                    <li class="prev"><a href="#"><i class="icon align-middle an an-caret-left" aria-hidden="true"></i></a></li>
                                    <li class="active"><a href="#">1</a></li>
                                    <li><a href="#">2</a></li>
                                    <li><a href="#">...</a></li>
                                    <li><a href="#">5</a></li>
                                    <li class="next"><a href="#"><i class="icon align-middle an an-caret-right" aria-hidden="true"></i></a></li>
                                </ul>
                            </div>
                            <!--End Pagination Classic-->

                          
                        </div>
                        <!--End Main Content-->
                    </div>
                </div>
            </div>
            <!--End Body Container-->


            {% endblock %}            


            {% block scripts %}
            <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.2/nouislider.min.js"></script>

            <script>
                var user = "{{ request.user }}";
                function getCookie(name) {
                    let cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        const cookies = document.cookie.split(';');
                        for (let i = 0; i < cookies.length; i++) {
                            const cookie = cookies[i].trim();
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                }
                
                const csrftoken = getCookie('csrftoken');
                
                
                </script>


                <script>
                    
                    function price_slider() {
                        $("#slider-range").slider({
                            range: true,
                            min: 1000,
                            max: 10000,
                            values: [1000, 10000],
                            slide: function(event, ui) {
                                $("#amount").val(ui.values[0] + " - " + ui.values[1]);
                            }
                        });
                        $("#amount").val($("#slider-range").slider("values", 0) + 
                                         " - " + $("#slider-range").slider("values", 1));
                    }
                
                    $(document).ready(function() {
                        price_slider();
                
                        $(".price-filter button").on("click", function(e) {
                            e.preventDefault();
                            let minPrice = $("#slider-range").slider("values", 0);
                            let maxPrice = $("#slider-range").slider("values", 1);
                
                            $.ajax({
                                url: '/filter_price/',  // URL to your filter endpoint
                                type: 'POST',
                                data: JSON.stringify({ min_price: minPrice, max_price: maxPrice }),
                                contentType: 'application/json',
                                success: function(response) {
                                    if (response.status === 'success') {
                                        $("#product-list").html(response.data);  // Update your product list container
                                    } else {
                                        console.error('Error filtering products');
                                    }
                                },
                                error: function() {
                                    console.error('Failed to send filter request');
                                }
                            });
                        });
                    });
                </script>


                <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>







                <script>
                    var slider = document.getElementById('slider-range');
                    noUiSlider.create(slider, {
                        start: [1000, 10000], // Initial values for the slider handle positions
                        connect: true, // Indicates whether the bar between the handles should be colored
                        range: {
                            'min': 1000, // Minimum value of the slider
                            'max': 10000 // Maximum value of the slider
                        },
                        step: 1, // Increment steps for the slider values
                        format: {
                            to: function (value) {
                                return value.toFixed(0); // Ensures the value is formatted as a fixed number
                            },
                            from: function (value) {
                                return Number(value); // Ensures the value is parsed back to a number
                            }
                        }
                    });
                    
                    slider.noUiSlider.on('update', function (values, handle) {
                        document.getElementById('amount').value = values.join(' - '); // Join the two values and display them in the input field
                    });
                    
                    let priceFilterUrl = "{% url 'filter_price' %}";
                    
                    let procurePriceData = async (min_price, max_price) => {
                        let res = await fetch(priceFilterUrl, {
                            method: 'POST',
                            headers: {
                                'Content-type': 'application/json',
                                'X-CSRFToken': '{{csrf_token}}',
                            },
                            body: JSON.stringify({
                                min_price: min_price,
                                max_price: max_price,
                            }),
                        });
                        return await res.json();
                    }
                    
                    let container = document.getElementById('product-container');
                    let filterButton = document.querySelector('.price-filter button');
                    
                    filterButton.addEventListener('click', async (event) => {
                        event.preventDefault();
                        let minPrice = parseFloat(document.getElementById('slider-range').noUiSlider.get()[0]);
                        let maxPrice = parseFloat(document.getElementById('slider-range').noUiSlider.get()[1]);
                        let data = await procurePriceData(minPrice, maxPrice); // Send the price range to the server
                        console.log(minPrice, maxPrice);
                        console.log(data);
                        container.innerHTML = data.data; // Update the product container with the filtered products
                    });
                </script>
                






                <script>
                    let url = "{% url 'filter_category' %}"
                    let procuredata = async (category_id) => {
                        let res = await fetch(url,{
                            method : 'POST',
                            headers : {
                                'Content-type':'application/json',  
                                'X-CSRFToken':'{{csrf_token}}',
                            },
                            body : JSON.stringify({
                                categories : category_id
                            })
                        })
                        return await res.json()
                    }
                   
                    let checkboxes = document.querySelectorAll('.checker')
                    checkboxes.forEach((check)=>{
                        check.addEventListener('change',async (event)=>{
                            let checkbox = Array.from(checkboxes).filter((checke)=>checke.checked).map((checke)=>checke.value);
                            let data = await procuredata(checkbox)
                            console.log(checkbox)
                            console.log(data)
                            container.innerHTML = data.data

                        })
                    })



                </script>

            {% endblock %}














            